nano /etc/resolv.conf ; nano /etc/apt/sources.list #cdrom
nameserver 8.8.8.8
1) Имена: hostnamectl set-hostname ***.au-team.irpo; exec bash
2) Время: timedatectl set-timezone Asia/Krasnoyarsk
3) Пользователи: 
на HQ-SRV & BR-SRV: 
useradd -m -s /bin/bash sshuser -u 2026 -U
usermod -aG sudo sshuser
passwd sshuser (ставим P@ssw0rd)
visudo
sshuser ALL=(ALL:ALL) NOPASSWD:ALL
su - sshuser и sudo -i
на HQ-RTR & BR-RTR: 
useradd -m -s /bin/bash net_admin -U
usermod -aG sudo net_admin
passwd net_admin (ставим P@ssw0rd)
visudo
net_admin ALL=(ALL:ALL) NOPASSWD:ALL
su - net_admin и sudo -i
4) Статика:  
ISP:  
auto ens3
iface ens3 inet dhcp
auto ens4
iface ens4 inet static
address 172.16.1.1/28
auto ens5
iface ens5 inet static
address 172.16.2.1/28
post-up nft -f /etc/nftables.conf
(ISP,HQ-RTR,BR-RTR)
nano /etc/sysctl.d/sysctl.conf
net.ipv4.ip_forward=1
sysctl --system
8) Сделаем динамическую трансляцию адресов (ISP,HQ-RTR,BR-RTR):
nano /etc/nftables.conf
table ip nat {
        chain postrouting {
                type nat hook postrouting priority 100; policy accept
                meta l4proto { gre, ipip, ospf } counter return
                masquerade
        }
}
systemctl restart networking
ip -br a
HQ-RTR:
auto ens3
iface ens3 inet static
address 172.16.1.2/28
gateway 172.16.1.1
post-up nft -f /etc/nftables.conf
BR-RTR: 
auto ens3
iface ens3 inet static
address 172.16.2.2/28
gateway 172.16.2.1
auto ens4
iface ens4 inet static
address 192.168.200.1/28
post-up nft -f /etc/nftables.conf
HQ-SRV: 
auto ens3
iface ens3 inet static
address 192.168.100.2/27
gateway 192.168.100.1
HQ-CLI (ВРЕМЕННАЯ настройка, до задания с DHCP):
auto ens3
iface ens3 inet static
address 192.168.100.34/28
gateway 192.168.100.33
BR-SRV:  
auto ens3
iface ens3 inet static
address 192.168.200.2/28
gateway 192.168.200.1
5) Настройка VLAN на HQ-RTR:
apt install -y openvswitch-switch
ovs-vsctl add-br hq-sw
ovs-vsctl add-port hq-sw ens4 tag=100
ovs-vsctl add-port hq-sw ens5 tag=200
ovs-vsctl add-port hq-sw ens6 tag=999
ovs-vsctl add-port hq-sw vlan100 tag=100 -- set interface vlan100 type=internal
ovs-vsctl add-port hq-sw vlan200 tag=200 -- set interface vlan200 type=internal
ovs-vsctl add-port hq-sw vlan999 tag=999 -- set interface vlan999 type=internal
nano /etc/network/interfaces
auto ens3
iface ens3 inet static
address 172.16.1.2/28
gateway 172.16.1.1
auto vlan100
iface vlan100 inet static
address 192.168.100.1/27
auto vlan200
iface vlan200 inet static
address 192.168.100.33/28
auto vlan999
iface vlan999 inet static
address 192.168.100.49/29
post-up nft -f /etc/nftables.conf
post-up ip link set hq-sw up
systemctl restart networking
ping 192.168.100.2, ping 192.168.100.34
6) Безопасный SSH-доступ (HQ-SRV, BR-SRV):
apt install -y openssh-server
nano /etc/ssh/sshd_config
Port 2026
AllowUsers sshuser
MaxAuthTries 2
Banner /etc/ssh_banner
nano /etc/ssh_banner
**************************
*                        *
* Authorized access only *
*                        *
**************************
systemctl restart ssh
С HQ-CLI НА HQ-SRV
ssh sshuser@192.168.100.2 -p 2026
yes
P@ssw0rd
sudo -i
7) GRE-туннель между HQ-RTR и BR-RTR:
На HQ-RTR
nmtui
Добавить → Туннель IP → Режим GRE.
имя профиля: gre
устройство: tun1
Родительский: ens3.
Локальный IP: 172.16.1.2.
Удалённый IP: 172.16.2.2.
IPv4: 10.10.0.1/30.
На BR-RTR
Аналогично, но:
Локальный IP: 172.16.2.2.
Удалённый IP: 172.16.1.2.
IPv4: 10.10.0.2/30.
nano /etc/network/interface
post-up ip link set gre0 up (на hq-rtr и br-rtr)
systemctl restart networking
ip -br a
nmcli connection modify gre ip.tunnel.ttl 64 (на hq-rtr и br-rtr)
ping 10.10.0.2  # с HQ-RTR
ping 10.10.0.1  # с BR-RTR
9) Динамическая маршрутизация OSPF (HQ-RTR и BR-RTR):
НА HQ-RTR:
apt install -y frr
nano /etc/frr/daemons
Ищем строчку ospfd=no и меняем на ospfd=yes
systemfctl restart frr
vtysh
conf t
router ospf
router-id 1.1.1.1
no passive-interface default
network 192.168.100.0/27 area 0
network 192.168.100.32/28 area 0
network 10.10.0.0/30 area 0
area 0 authentication
int tun1
no ip ospf passive
no ip ospf network broadcast
ip ospf authentication
ip ospf authentication-key password
exit
exit
wr
НА BR-RTR:
apt install -y frr
nano /etc/frr/daemons
Ищем строчку ospfd=no и меняем на ospfd=yes
systemfctl restart frr
vtysh
conf t
router ospf
router-id 2.2.2.2
no passive-interface default
network 192.168.200.0/28 area 0
network 10.10.0.0/30 area 0
area 0 authentication
int tun1
no ip ospf passive
no ip ospf network broadcast
ip ospf authentication
ip ospf authentication-key password
exit
exit
wr
на обоих устройствах reboot
vtysh
show ip ospf neighbor
с HQ-SRV пингануть BR-SRV
ping 192.168.200.2
